@model IEnumerable<OzSapkaTShirt.Models.Order>

@{
    ViewData["Title"] = "Index";
}
<h2>Siparişleriniz</h2>
<hr />
<h3>Sipariş Detayları</h3>



    <table class="table table-striped">
        <thead>
            <tr>           
               
                <th>Sipariş Fiyat Toplam</th>
                <th>Sipariş Tarihi</th>
                <th>Sipariş Durumu</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model)
            {
                <tr>              
                <td>@order.TotalPrice</td>
                <td>@order.OrderDate</td>
                <td>@GetStatusName(order.Status)</td>              
                <td><i class="fa-solid fa-trash" onclick="RemoveOrder('@order.Id')"></i></td>
                @if(order.Status<3)
                {
                    <td><a asp-action="Edit" asp-route-id="@order.Id">Sipariş Düzenle</a></td>
                }
              
                </tr>
               
                    


            }
        </tbody>
    </table>
<div id="successMessage" class="alert alert-success" style="display: none;"></div>
<div class="message-container"></div>

<script>
    function RemoveOrder(orderId) {
        if (!confirm("Ürünü sepetten kaldırmak istediğinizden emin misiniz?")) {
            return;
        }

        $.ajax({
            type: "POST",
            url: "@Url.Action("RemoveOrder","Orders")" + "/" + orderId, // Hata düzeltildi
            success: function (result) {
                showMessage("Sipariş kaldırıldı.", "success");
                $(".table table-striped tbody").html(result);
            },
            error: function (error) {
                showMessage("Sipariş kaldırılırken bir hata oluştu.", "error");
            }
        });
    }

    function showMessage(message, messageType) {
        var alertClass = "alert-info";
        if (messageType === "success") {
            alertClass = "alert-success";
        } else if (messageType === "error") {
            alertClass = "alert-danger";
        }

        var alertHtml = '<div class="alert ' + alertClass + '">' + message + '</div>';
        $(".message-container").html(alertHtml).fadeIn(500).fadeOut(500);
    }
    function updateCartView(cartData) {
        // Sepet görüntüsünü güncelle
        $(".cart-items").html(cartData.itemsCount);
        $(".cart-total").html(cartData.totalPrice);
    }









</script>



@functions
{
    string GetStatusName(int status)
    {
        string statusName = string.Empty;
        switch (status)
        {
            case 0:
                statusName = "Sepette";
                break;
            case 1:
                statusName = "Sipariş Alındı";
                break;
            case 2:
                statusName = "Hazırlanıyor";
                break;
            case 3:
                statusName = "Kargoya Verildi";
                break;
            case 4:
                statusName = "Tamamlandı";
                break;
            default:
                statusName = "Bilinmeyen Durum";
                break;
        }
        return statusName;
    }
}